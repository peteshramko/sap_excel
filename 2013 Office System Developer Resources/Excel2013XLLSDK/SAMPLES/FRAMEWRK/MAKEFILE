!if "$(TYPE)" == ""
TYPE=DEBUG
!endif

SDKDIR  =   ..\..
FRAMEWORKDIR=	.
!if "$(PLATFORM)" == "Win32" || "$(PLATFORM)" == "x86" || "$(PLATFORM)" == ""
FRAMEWORKBUILDDIR = $(FRAMEWORKDIR)\$(TYPE)
TARGETLIBDIR = $(SDKDIR)\lib
PREVDIR = .\..
!else
FRAMEWORKBUILDDIR = $(FRAMEWORKDIR)\$(PLATFORM)\$(TYPE)
TARGETLIBDIR = $(SDKDIR)\lib\$(PLATFORM)
PREVDIR = .\..\..
!endif
TARGETINCDIR = $(SDKDIR)\include
TARGETSRCDIR = $(SDKDIR)\src
PROJ = FRAMEWRK

COPY=copy /Y

!if "$(RM)" == ""
RM=-del /f /q
!endif

!if "$(RMDIR)" == ""
RMDIR=-rd /S /Q
!endif

all : TARGET_DELIVER

FRAMEWORK_BINARY   = "frmwrk32.lib"
FRAMEWORK_BINARY_COPY = $(TARGETLIBDIR)\$(FRAMEWORK_BINARY)
FRAMEWORK_INCLUDE  = /I. /I"$(TARGETINCDIR)" /I"$(TARGETSRCDIR)" /I"$(VCINSTALLDIR)\VC\PlatformSDK\Include" /I"$(VCINSTALLDIR)\VC\include"
FRAMEWORK_LIBS     = $(TARGETLIBDIR)\xlcall32.lib
FRAMEWORK_PDB	   = $(FRAMEWORKBUILDDIR)\$(PROJ).pdb
FRAMEWORK_PDB_COPY = "$(TARGETLIBDIR)\$(PROJ).pdb"   

FRAMEWORK_LIB_OPTS = /OUT:$(FRAMEWORK_BINARY) /nodefaultlib

!if "$(TYPE)" == "DEBUG"
FRAMEWORK_DEFINES  = /D"WIN32" /D"_WINDOWS" /D"_MBCS" /D"_USRDLL" /D"FRAMEWORK_EXPORTS" /D"_DEBUG"
!else
FRAMEWORK_DEFINES  = /D"WIN32" /D"_WINDOWS" /D"_MBCS" /D"_USRDLL" /D"FRAMEWORK_EXPORTS" /D"NDEBUG"
!endif

FRAMEWORK_OBJ =	MemoryManager.obj \
	MemoryPool.obj \
	FRAMEWRK.obj

FRAMEWORK_HEADER = $(TARGETINCDIR)\FRAMEWRK.H
FRAMEWORK_HEADER_FILES = $(FRAMEWORKDIR)\FRAMEWRK.H

.SUFFIXES:	.cpp .c .obj

!if "$(TYPE)" == "DEBUG"
CPPFLAGS        =/Od /W3 /WX /EHsc /Zi /MDd /Fd"$(FRAMEWORK_PDB)" /Fo"$(FRAMEWORKBUILDDIR)\\"
!else
CPPFLAGS        =/W3 /WX /EHsc /MD /Fo"$(FRAMEWORKBUILDDIR)\\"
!endif

minclean:
	$(RM) "$(FRAMEWORKBUILDDIR)\*.obj" 1>nul 2>nul
	$(RM) "$(FRAMEWORKBUILDDIR)\*.lib" 1>nul 2>nul
!if "$(TYPE)" == "DEBUG"	
	$(RM) "$(FRAMEWORKBUILDDIR)\*.pdb" 1>nul 2>nul 
!endif

clean:
	$(RM) $(FRAMEWORK_BINARY_COPY) 1>nul 2>nul
	$(RM) $(FRAMEWORK_HEADER) 1>nul 2>nul
!if "$(TYPE)" == "DEBUG"	
	$(RM) "$(FRAMEWORK_PDB_COPY)" 1>nul 2>nul 
!endif
	$(RM) "$(FRAMEWORKBUILDDIR)\*.*"
	$(RMDIR) $(FRAMEWORKBUILDDIR) 1>nul 2>nul
	
"$(TARGETLIBDIR)":
	if not exist "$(TARGETLIBDIR)" mkdir "$(TARGETLIBDIR)"
	
"$(FRAMEWORKBUILDDIR)":
	if not exist "$(FRAMEWORKBUILDDIR)" mkdir "$(FRAMEWORKBUILDDIR)"

TARGET_DELIVER: "$(FRAMEWORKBUILDDIR)" "$(TARGETLIBDIR)" $(FRAMEWORK_OBJ)
	cd $(FRAMEWORKBUILDDIR)
	lib.exe /nologo $(FRAMEWORK_OBJ) $(FRAMEWORK_LIB_OPTS)
	cd $(PREVDIR)
	$(COPY) $(FRAMEWORKBUILDDIR)\$(FRAMEWORK_BINARY) $(TARGETLIBDIR)
!if "$(TYPE)" == "DEBUG"
	$(COPY) $(FRAMEWORK_PDB) "$(TARGETLIBDIR)"
!endif
	$(COPY) "$(FRAMEWORK_HEADER_FILES)" "$(FRAMEWORK_HEADER)"
	
.cpp.obj:
	$(CPP) /nologo $(CPPFLAGS) $(FRAMEWORK_INCLUDE) $(FRAMEWORK_DEFINES) /c $<

.c.obj:
	$(CPP) /nologo $(CPPFLAGS) $(FRAMEWORK_INCLUDE) $(FRAMEWORK_DEFINES) /c $<
	